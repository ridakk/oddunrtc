<!DOCTYPE html>
<html ng-app="app">
    <head>
                <script src="canvas-to-blob.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    </head>

    <body>
		<div class="camera">
			<video id="video">Video stream not available.</video>
			<button id="startbutton">Take photo</button>
		</div>
		<canvas id="canvas">
		</canvas>
		<div class="output">
			<img id="photo" alt="The screen capture will appear in this box.">
		</div>
    </body>

    <script>
	document.addEventListener('DOMContentLoaded', () => {
	var video = document.getElementById('video');
    canvas = document.getElementById('canvas');
    photo = document.getElementById('photo');
	
	navigator.webkitGetUserMedia({audio:false, video: true}, (stream)=>{video.src = webkitURL.createObjectURL(stream)}, ()=>{})
	
	video.play();
	
	function takepicture() {
		var context = canvas.getContext('2d');
		  canvas.width = 640;
		  canvas.height = 480;
		  context.drawImage(video, 0, 0, 640, 480);
		
		  var data = canvas.toDataURL('image/png');
		  photo.setAttribute('src', data);
	  
		canvas.toBlob(function (blob) {			
			var arrayBuffer;
			var fileReader = new FileReader();
			fileReader.onload = function () {

				function blobToFile(theBlob, fileName){
					//A Blob() is almost a File() - it's just missing the two properties below which we will add
					theBlob.lastModifiedDate = new Date();
					theBlob.name = fileName;
					return theBlob;
				}

				file = blobToFile(this.result, 'screenshot');
				
				$.ajax({
					url: "https://api.projectoxford.ai/emotion/v1.0/recognize",
					beforeSend: function(xhrObj){
						// Request headers
						xhrObj.setRequestHeader("Content-Type","application/octet-stream");
						xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","aa64048390bf4b53aff405263d099283");
					},
					type: "POST",
					// Request body
					data: file,
					processData: false
				})
				.done(function(data) {
					alert("success");
					console.log(data);
				})
				.fail(function() {
					alert("error");
				});
			};
			fileReader.readAsArrayBuffer(blob);
		});
	}
	
	setTimeout(function(){
		takepicture();
	}, 2000);
	})
    </script>

</html>
